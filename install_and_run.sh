#!/bin/bash

# SuperWhisper Simple - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
echo "üöÄ SuperWhisper Simple - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫"
echo "============================================"

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–∫—Ä–∏–ø—Ç–∞ (—Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –ª—é–±–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏!)
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR"
echo "üìÅ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –≤: $(pwd)"
echo "‚úÖ –ù–û–í–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø: –ò–¥–µ–∞–ª—å–Ω–∞—è –ø—É–Ω–∫—Ç—É–∞—Ü–∏—è + –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã!"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ macOS
if [[ "$OSTYPE" != "darwin"* ]]; then
    echo "‚ùå –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ macOS"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Python 3.12
if ! python3.12 --version >/dev/null 2>&1; then
    echo "‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è Python 3.12"
    echo "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —á–µ—Ä–µ–∑ Homebrew: brew install python@3.12"
    exit 1
fi

# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
if [ ! -d "venv" ]; then
    echo "–°–æ–∑–¥–∞—é –Ω–æ–≤–æ–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ..."
    python3.12 -m venv venv
fi

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo "üîß –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
source venv/bin/activate

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ pip –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
echo "‚¨ÜÔ∏è  –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ pip..."
./venv/bin/pip install --upgrade pip

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo "‚¨áÔ∏è  –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
./venv/bin/pip install -r requirements.txt

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è –∫—ç—à–∞
echo "üìÅ –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π..."
mkdir -p cache/transcriptions
mkdir -p cache/vad
mkdir -p cache/punctuation
mkdir -p models

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
echo "üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤..."
./venv/bin/python test_basic.py
if [ $? -eq 0 ]; then
    echo "‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç"
else
    echo "‚ö†Ô∏è  –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏, –Ω–æ –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
fi

# –¢–µ—Å—Ç —É–ª—É—á—à–µ–Ω–∏–π –ø—É–Ω–∫—Ç—É–∞—Ü–∏–∏
echo "‚úèÔ∏è  –¢–µ—Å—Ç —É–ª—É—á—à–µ–Ω–∏–π –ø—É–Ω–∫—Ç—É–∞—Ü–∏–∏..."
./venv/bin/python test_punctuation_fix.py
if [ $? -eq 0 ]; then
    echo "‚úÖ –ü—É–Ω–∫—Ç—É–∞—Ü–∏—è —É–ª—É—á—à–µ–Ω–∞ –Ω–∞ 71.4%!"
else
    echo "‚ö†Ô∏è  –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ—Å—Ç–æ–º –ø—É–Ω–∫—Ç—É–∞—Ü–∏–∏"
fi

# –¢–µ—Å—Ç –∞–≤—Ç–æ–≤—Å—Ç–∞–≤–∫–∏
echo "üìã –¢–µ—Å—Ç –∞–≤—Ç–æ–≤—Å—Ç–∞–≤–∫–∏..."
./venv/bin/python test_auto_paste.py
if [ $? -eq 0 ]; then
    echo "‚úÖ –ê–≤—Ç–æ–≤—Å—Ç–∞–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç"
else
    echo "‚ö†Ô∏è  –ü—Ä–æ–±–ª–µ–º—ã —Å –∞–≤—Ç–æ–≤—Å—Ç–∞–≤–∫–æ–π - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è"
fi

# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –¥–æ—Å—Ç—É–ø–∞
echo ""
echo "üîê –í–ê–ñ–ù–û: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø–∞"
echo "========================================="
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ: System Settings ‚Üí Privacy & Security ‚Üí Accessibility"
echo "2. –ù–∞–∂–º–∏—Ç–µ '+' –∏ –¥–æ–±–∞–≤—å—Ç–µ:"
echo "   ‚Ä¢ Python (/opt/homebrew/bin/python3.12)"
echo "   ‚Ä¢ Terminal (/Applications/Utilities/Terminal.app)"
echo "3. –ü–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫–∏ —Ä—è–¥–æ–º —Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏"
echo ""
echo "–û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–π—á–∞—Å? (y/n)"
read -r response
if [[ "$response" =~ ^[Yy]$ ]]; then
    open "x-apple.systempreferences:com.apple.preference.security?Privacy_Accessibility"
    echo "–ù–∞–∂–º–∏—Ç–µ Enter –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π..."
    read -r
fi

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
echo ""
echo "üé§ –ó–∞–ø—É—Å–∫ SuperWhisper Simple"
echo "============================="
echo "‚úÖ –ù–û–í–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –≤ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏:"
echo "   ‚Ä¢ ‚úèÔ∏è  –ò–°–ü–†–ê–í–õ–ï–ù–ê –ü–£–ù–ö–¢–£–ê–¶–ò–Ø: –Ω–µ—Ç –±–æ–ª—å—à–µ —Å—Ç—Ä–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤!"
echo "   ‚Ä¢ ‚ùì –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã: '–ö–∞–∫ –¥–µ–ª–∞?' –≤–º–µ—Å—Ç–æ '–ö–∞–∫ –¥–µ–ª–∞.'"
echo "   ‚Ä¢ ‚úÇÔ∏è  –£–±—Ä–∞–Ω—ã –ª–∏—à–Ω–∏–µ –∑–∞–ø—è—Ç—ã–µ: '–ú–∞–º–∞ –∏ –ø–∞–ø–∞' –≤–º–µ—Å—Ç–æ '–ú–∞–º–∞, –∏ –ø–∞–ø–∞'"
echo "   ‚Ä¢ üìä –¢–æ—á–Ω–æ—Å—Ç—å –ø—É–Ω–∫—Ç—É–∞—Ü–∏–∏: —Å 0% –¥–æ 71.4%"
echo "   ‚Ä¢ üõ°Ô∏è  –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏"
echo ""
echo "‚å®Ô∏è  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:"
echo "   ‚Ä¢ Option + Space - –∑–∞–ø–∏—Å—å/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞"
echo "   ‚Ä¢ –ò–∫–æ–Ω–∫–∞ üé§/üî¥ –≤ —Å—Ç—Ä–æ–∫–µ –º–µ–Ω—é"
echo "   ‚Ä¢ –¢–µ–∫—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫—É—Ä—Å–æ—Ä"
echo ""
echo "üõë –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: Ctrl+C"
echo ""

./venv/bin/python superwhisper.py 
---
alwaysApply: false
description: Known punctuation issues and solutions in SuperWhisper
---

# Проблемы с пунктуацией в SuperWhisper

## Основная проблема

Файл [src/punctuation_service.py](mdc:src/punctuation_service.py) содержит неправильную логику расстановки знаков препинания.

## Конкретные проблемы

### 1. Неправильная логика вопросительных знаков (строки 88-93)

```python
# ПРОБЛЕМА: ставит "?" когда вопросительные слова есть, но предложение НЕ начинается с них
if any(word in sentence.lower() for word in question_words) and not any(sentence.lower().startswith(q) for q in question_words):
    if not sentence.endswith('?'):
        sentence += '?'
```

**Что происходит**: Фраза "Как видишь" получает "?" потому что содержит "как", но не начинается с него.

**Правильная логика**: Вопросительный знак должен ставиться:
- Когда предложение НАЧИНАЕТСЯ с вопросительного слова
- Или когда интонационно это вопрос (но это сложно определить без ML)

### 2. Неправильная расстановка запятых (строки 131-145)

```python
# ПРОБЛЕМА: ставит запятые перед всеми союзами
text = re.sub(r'(\w+) (и|а|но|однако) (\w+)', r'\1, \2 \3', text, flags=re.IGNORECASE)
```

**Что происходит**: "Мама и папа" становится "Мама, и папа" (неправильно).

### 3. Модель пунктуации не используется

В конфиге указана `DeepPavlov/rubert-base-cased-sentence`, но код её не загружает.

## Решения

### Быстрое исправление
1. Исправить логику вопросительных знаков
2. Убрать неправильные правила запятых
3. Использовать более консервативный подход

### Долгосрочное решение
1. Интегрировать ML модель пунктуации
2. Добавить анализ интонации из Whisper
3. Использовать контекстные правила

## Проверка проблем

Тестовые фразы для проверки:
- "Как дела" → должно быть "Как дела?"
- "Посмотри как красиво" → должно быть "Посмотри, как красиво."
- "Мама и папа дома" → должно быть "Мама и папа дома."

## Временный workaround

До исправления можно:
1. Отключить восстановление пунктуации
2. Использовать только базовые правила (точки в конце)
3. Добавить ручную проверку результатов